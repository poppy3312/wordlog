<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>WordLog æ•°æ®æŸ¥çœ‹å™¨</title>
    <style>
        body { font-family: -apple-system, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        h1 { color: #333; }
        .section { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
        button { background: #007AFF; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #0051D5; }
        .data-preview { background: white; padding: 10px; border-radius: 4px; margin-top: 10px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 12px; }
        .storage-key { color: #666; margin: 5px 0; }
        .backup-btn { background: #34C759; }
    </style>
</head>
<body>
    <h1>ğŸ” WordLog æ•°æ®æŸ¥çœ‹å™¨</h1>
    
    <div class="section">
        <h2>ğŸ“ å½“å‰ä½ç½®ä¿¡æ¯</h2>
        <p><strong>åŸŸå:</strong> <span id="domain"></span></p>
        <p><strong>ç”¨æˆ·ä»£ç†:</strong> <span id="userAgent"></span></p>
    </div>

    <div class="section">
        <h2>ğŸ“¦ LocalStorage æ•°æ®</h2>
        <button onclick="checkLocalStorage()">æ£€æŸ¥ LocalStorage</button>
        <button onclick="backupLocalStorage()" class="backup-btn">ğŸ’¾ å¤‡ä»½æ‰€æœ‰æ•°æ®</button>
        <div id="localStorageResult"></div>
    </div>

    <div class="section">
        <h2>ğŸ—‚ï¸ IndexedDB æ•°æ®</h2>
        <button onclick="checkIndexedDB()">æ£€æŸ¥ IndexedDB</button>
        <div id="indexedDbResult"></div>
    </div>

    <script>
        document.getElementById('domain').textContent = window.location.href;
        document.getElementById('userAgent').textContent = navigator.userAgent.substring(0, 100) + '...';

        function checkLocalStorage() {
            const result = document.getElementById('localStorageResult');
            const keys = Object.keys(localStorage);
            
            if (keys.length === 0) {
                result.innerHTML = '<p>âŒ LocalStorage ä¸ºç©º</p>';
                return;
            }

            let html = '<p>âœ… æ‰¾åˆ° ' + keys.length + ' ä¸ªæ•°æ®é¡¹ï¼š</p>';
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                const preview = value.length > 100 ? value.substring(0, 100) + '...' : value;
                html += `
                    <div class="storage-key">
                        <strong>Key:</strong> ${key}<br>
                        <strong>é•¿åº¦:</strong> ${value.length} å­—ç¬¦<br>
                        <strong>é¢„è§ˆ:</strong> <pre>${preview}</pre>
                    </div>
                `;
            });
            result.innerHTML = html;
        }

        function backupLocalStorage() {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data[key] = localStorage.getItem(key);
            }
            
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'wordlog-backup-' + new Date().toISOString().slice(0,10) + '.json';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… æ•°æ®å·²å¤‡ä»½åˆ°ä¸‹è½½æ–‡ä»¶å¤¹ï¼');
        }

        async function checkIndexedDB() {
            const result = document.getElementById('indexedDbResult');
            const databases = await indexedDB.databases();
            
            if (databases.length === 0) {
                result.innerHTML = '<p>âŒ æ²¡æœ‰ IndexedDB æ•°æ®åº“</p>';
                return;
            }

            let html = '<p>âœ… æ‰¾åˆ° ' + databases.length + ' ä¸ªæ•°æ®åº“ï¼š</p>';
            databases.forEach(db => {
                html += `<div class="storage-key"><strong>æ•°æ®åº“:</strong> ${db.name}<br><strong>ç‰ˆæœ¬:</strong> ${db.version}</div>`;
            });
            result.innerHTML = html;
        }
    </script>
</body>
</html>
