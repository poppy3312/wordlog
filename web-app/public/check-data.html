<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>WordLog - æ•°æ®æ£€æŸ¥</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 { color: #D97757; margin-bottom: 20px; }
        button {
            background: #D97757;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #c06649; }
        .word-item {
            border: 1px solid #e0e0e0;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #fafafa;
        }
        .word-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .data-field {
            margin: 5px 0;
            font-size: 14px;
            color: #666;
        }
        .data-field strong {
            color: #D97757;
        }
        .error {
            color: #c62828;
            background: #ffebee;
            padding: 10px;
            border-radius: 8px;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” WordLog æ•°æ®æ£€æŸ¥</h1>

        <button onclick="checkData()">æ£€æŸ¥æ•°æ®</button>
        <button onclick="fixData()">ä¿®å¤æ•°æ®</button>
        <button onclick="clearAll()" style="background:#666">æ¸…ç©ºæ‰€æœ‰</button>

        <div id="output"></div>
    </div>

    <script>
        function showOutput(html) {
            document.getElementById('output').innerHTML = html;
        }

        function checkData() {
            const data = localStorage.getItem('wordlog_words');
            if (!data) {
                showOutput('<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°å•è¯æ•°æ®</div>');
                return;
            }

            const words = JSON.parse(data);
            let html = `<h3>å…±æœ‰ ${words.length} ä¸ªå•è¯</h3>`;
            let errors = [];

            words.forEach((word, index) => {
                let hasError = false;
                let wordHtml = `<div class="word-item">`;
                wordHtml += `<div class="word-title">${index + 1}. ${word.word}</div>`;

                // æ£€æŸ¥ wordLower
                if (!word.wordLower) {
                    wordHtml += `<div class="data-field error"><strong>âš ï¸ wordLower ç¼ºå¤±</strong></div>`;
                    hasError = true;
                } else {
                    wordHtml += `<div class="data-field"><strong>wordLower:</strong> ${word.wordLower}</div>`;
                }

                // æ£€æŸ¥ pronunciation
                wordHtml += `<div class="data-field"><strong>pronunciation:</strong> ${word.pronunciation || 'âŒ ç¼ºå¤±'}</div>`;

                // æ£€æŸ¥ definitions
                if (!word.definitions || !Array.isArray(word.definitions)) {
                    wordHtml += `<div class="data-field error"><strong>âš ï¸ definitions ä¸æ˜¯æ•°ç»„: ${typeof word.definitions}</strong></div>`;
                    hasError = true;
                } else if (word.definitions.length === 0) {
                    wordHtml += `<div class="data-field error"><strong>âš ï¸ definitions æ˜¯ç©ºæ•°ç»„</strong></div>`;
                    hasError = true;
                } else {
                    wordHtml += `<div class="data-field"><strong>definitions:</strong> ${word.definitions.length} ä¸ªé‡Šä¹‰</div>`;

                    word.definitions.forEach((def, i) => {
                        wordHtml += `<div style="margin-left:20px;font-size:12px;color:#888;">`;
                        wordHtml += `[${i}] partOfSpeech: ${def.partOfSpeech || 'âŒ'}<br>`;
                        wordHtml += `&nbsp;&nbsp;&nbsp;&nbsp;definition: ${def.definition ? (def.definition.substring(0, 50) + '...') : 'âŒ'}<br>`;
                        wordHtml += `&nbsp;&nbsp;&nbsp;&nbsp;example: ${def.example ? 'âœ…' : 'âŒ'}`;
                        wordHtml += `</div>`;
                    });
                }

                // æ£€æŸ¥ source
                wordHtml += `<div class="data-field"><strong>source:</strong> ${word.source || 'undefined'}</div>`;

                wordHtml += `</div>`;
                html += wordHtml;

                if (hasError) {
                    errors.push(word.word);
                }
            });

            if (errors.length > 0) {
                html = `<div class="error">å‘ç° ${errors.length} ä¸ªå•è¯æœ‰æ•°æ®é—®é¢˜ï¼š${errors.join(', ')}</div>` + html;
            }

            showOutput(html);
        }

        function fixData() {
            const data = localStorage.getItem('wordlog_words');
            if (!data) {
                showOutput('<div class="error">âŒ æ²¡æœ‰æ‰¾åˆ°å•è¯æ•°æ®</div>');
                return;
            }

            let words = JSON.parse(data);
            let fixedCount = 0;

            words = words.map(word => {
                // ç¡®ä¿ wordLower å­˜åœ¨
                if (!word.wordLower) {
                    word.wordLower = (word.word || '').toLowerCase();
                    fixedCount++;
                }

                // ç¡®ä¿ definitions æ˜¯æ•°ç»„
                if (!word.definitions || !Array.isArray(word.definitions)) {
                    word.definitions = [{
                        partOfSpeech: 'æœªçŸ¥',
                        definition: word.definition || 'æš‚æ— é‡Šä¹‰',
                        example: word.example || '',
                        exampleTranslation: word.exampleTranslation || ''
                    }];
                    fixedCount++;
                }

                // ç¡®ä¿ definitions ä¸ä¸ºç©º
                if (word.definitions.length === 0) {
                    word.definitions = [{
                        partOfSpeech: 'æœªçŸ¥',
                        definition: 'æš‚æ— é‡Šä¹‰',
                        example: '',
                        exampleTranslation: ''
                    }];
                    fixedCount++;
                }

                return word;
            });

            localStorage.setItem('wordlog_words', JSON.stringify(words));
            showOutput(`<div style="background:#e8f5e9;padding:15px;border-radius:8px;color:#2e7d32;">
                âœ… å·²ä¿®å¤ ${fixedCount} ä¸ªæ•°æ®é—®é¢˜ï¼<br><br>
                <a href="http://localhost:3001" style="color:#D97757;font-weight:bold;">è¿”å›ä¸»é¡µé¢</a>
            </div>`);
        }

        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å•è¯æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                localStorage.removeItem('wordlog_words');
                localStorage.removeItem('wordlog_stats');
                showOutput('<div style="background:#e8f5e9;padding:15px;border-radius:8px;color:#2e7d32;">âœ… å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®</div>');
            }
        }
    </script>
</body>
</html>
